# Project Architecture & Flow Documentation

Complete technical architecture documentation for the Revival Project offline mode.

---

## Table of Contents

1. [Game Startup Flow](#game-startup-flow)
2. [Authentication Flow](#authentication-flow)
3. [Scene Architecture](#scene-architecture)
4. [Class Relationships](#class-relationships)
5. [Data Flow Diagrams](#data-flow-diagrams)
6. [System Integration Points](#system-integration-points)

---

## Game Startup Flow

### Complete Boot Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. USER LAUNCHES GAME EXECUTABLE                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ENTRY POINT: 10076230044261121434.py                      â”‚
â”‚    â€¢ Main entry script executed                              â”‚
â”‚    â€¢ Sets up Python environment                              â”‚
â”‚    â€¢ Imports core modules                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. BOOTSTRAP: script_patch/573/10076230044261121434.py       â”‚
â”‚    â€¢ logic() function called                                 â”‚
â”‚    â€¢ âŒ Server update checks (REMOVED)                       â”‚
â”‚    â€¢ âœ… Direct call to start_game()                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. INIT GAME MODULE                                          â”‚
â”‚    â€¢ Engine initialization                                   â”‚
â”‚    â€¢ Graphics setup (OpenGL/DirectX)                         â”‚
â”‚    â€¢ Audio system init                                       â”‚
â”‚    â€¢ Input handlers registered                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. MANAGER INITIALIZATION                                    â”‚
â”‚    File: script_patch/422/14606205992556332510.py            â”‚
â”‚    â€¢ Manager.get_manager().init()                            â”‚
â”‚    â€¢ Singleton pattern                                       â”‚
â”‚    â€¢ Resource management setup                               â”‚
â”‚    â€¢ Download system ready (fixed bug)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. REVIVAL CLASS INITIALIZATION â˜…â˜…â˜…                          â”‚
â”‚    File: 785_17524466876519882393.py                         â”‚
â”‚    â€¢ Revival.initialize() called                             â”‚
â”‚    â€¢ _disable_version_update_notifications()                 â”‚
â”‚    â€¢ âœ… OFFLINE LOGIN SYSTEM INITIALIZED                     â”‚
â”‚    â€¢   - OfflineLoginHelper class defined                    â”‚
â”‚    â€¢   - get_offline_login_helper() defined                  â”‚
â”‚    â€¢   - patch_partlogin_for_offline() defined               â”‚
â”‚    â€¢   - PartLogin class PATCHED at runtime                  â”‚
â”‚    â€¢ Game configuration applied                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. SCENE LOADING - LoginScene                                â”‚
â”‚    File: script_patch/609/11026820604907119192.py            â”‚
â”‚    â€¢ LoginScene class instantiated                           â”‚
â”‚    â€¢ PartLogin component created (ALREADY PATCHED)           â”‚
â”‚    â€¢ UI elements loaded (text fields, buttons)               â”‚
â”‚    â€¢ Offline helper attached to PartLogin instance           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. LOGIN UI DISPLAYED                                        â”‚
â”‚    â€¢ Username input field                                    â”‚
â”‚    â€¢ Password input field                                    â”‚
â”‚    â€¢ Login button (click handler = offline authentication)   â”‚
â”‚    â€¢ UI rendered on screen                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. WAITING FOR USER INPUT                                    â”‚
â”‚    â€¢ User enters credentials                                 â”‚
â”‚    â€¢ User clicks "Login" button                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                [See Authentication Flow]
```

### Original vs Modified Flow

#### Original (Server-Dependent)

```
Entry â†’ Check AAB Updates â†’ Download Patches â†’ Show PatchUI 
  â†’ Wait for Download â†’ Manager Init â†’ Revival Init â†’ LoginScene 
  â†’ Send Credentials to Server â†’ Wait for Response â†’ Enter Game
```

**Problems:**
- âŒ Requires internet connection
- âŒ Server must be online
- âŒ Update checks add delay
- âŒ Patch downloads required

#### Modified (Offline)

```
Entry â†’ Manager Init â†’ Revival Init (patch applied) â†’ LoginScene 
  â†’ Local Credential Check â†’ Enter Game
```

**Benefits:**
- âœ… No internet required
- âœ… Instant startup
- âœ… No external dependencies
- âœ… Consistent experience

---

## Authentication Flow

### Offline Authentication Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER ENTERS CREDENTIALS                                      â”‚
â”‚ â€¢ Username: "test"                                           â”‚
â”‚ â€¢ Password: "test"                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER CLICKS "LOGIN" BUTTON                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PartLogin._on_login_button_click() CALLED                    â”‚
â”‚ (Patched version - offline authentication)                   â”‚
â”‚                                                              â”‚
â”‚ Code Location: Revival.initialize() â†’ patch function         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EXTRACT CREDENTIALS FROM UI                                  â”‚
â”‚                                                              â”‚
â”‚ username = self.account_input.text  # "test"                 â”‚
â”‚ password = self.password_input.text # "test"                 â”‚
â”‚                                                              â”‚
â”‚ Console: [OfflineLogin] Username: test                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CALL OFFLINE VERIFICATION                                    â”‚
â”‚                                                              â”‚
â”‚ success, result = self.offline_helper.verify_login(          â”‚
â”‚     username, password                                       â”‚
â”‚ )                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OfflineLoginHelper.verify_login() EXECUTED                   â”‚
â”‚                                                              â”‚
â”‚ 1. Check if username exists in self.accounts                 â”‚
â”‚    â€¢ self.accounts = loaded from offline_accounts.json       â”‚
â”‚                                                              â”‚
â”‚ 2. If not found:                                             â”‚
â”‚    â†’ return (False, 'Account not found')                     â”‚
â”‚                                                              â”‚
â”‚ 3. If found, compare passwords:                              â”‚
â”‚    stored_password = account_data['password']                â”‚
â”‚    if password != stored_password:                           â”‚
â”‚       â†’ return (False, 'Incorrect password')                 â”‚
â”‚                                                              â”‚
â”‚ 4. If match:                                                 â”‚
â”‚    â†’ Build player_data dict                                  â”‚
â”‚    â†’ return (True, player_data)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ AUTHENTICATION       â”‚
              â”‚ RESULT?              â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“         â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUCCESS = True  â”‚              â”‚ SUCCESS = False â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SET GLOBAL PLAYER DATA      â”‚  â”‚ SHOW ERROR MESSAGE          â”‚
â”‚                             â”‚  â”‚                             â”‚
â”‚ import game_data            â”‚  â”‚ console: [OfflineLogin]     â”‚
â”‚ game_data.player_id = ...   â”‚  â”‚ Authentication failed       â”‚
â”‚ game_data.player_name = ... â”‚  â”‚                             â”‚
â”‚ game_data.player_level = ...â”‚  â”‚ if hasattr(self,            â”‚
â”‚ game_data.player_exp = ...  â”‚  â”‚   'show_error'):            â”‚
â”‚ game_data.player_gold = ... â”‚  â”‚     self.show_error(...)    â”‚
â”‚ game_data.player_gems = ... â”‚  â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TRANSITION TO MAIN GAME     â”‚  â”‚ STAY ON LOGIN SCREEN        â”‚
â”‚                             â”‚  â”‚                             â”‚
â”‚ from scene.battle.          â”‚  â”‚ User can try again          â”‚
â”‚   battle_main import        â”‚  â”‚                             â”‚
â”‚   BattleMain                â”‚  â”‚                             â”‚
â”‚                             â”‚  â”‚                             â”‚
â”‚ self.scene.change_scene(    â”‚  â”‚                             â”‚
â”‚   BattleMain                â”‚  â”‚                             â”‚
â”‚ )                           â”‚  â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GAME LOADED - FULL ACCESS                                    â”‚
â”‚ â€¢ Player data loaded                                         â”‚
â”‚ â€¢ All game systems available                                 â”‚
â”‚ â€¢ No network connectivity required                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Original vs Modified Authentication

#### Original (Server-Based)

```
Login Button Click
    â†“
PartLogin._on_login_button_click()
    â†“
Build HTTP request with credentials
    â†“
Send POST request to auth server
    â†“
Wait for response (network latency)
    â†“
Parse server response (JSON/XML)
    â†“
If success: Extract session token, player data
If failure: Show server error message
    â†“
Set global player data
    â†“
Load game
```

**Dependencies:**
- âŒ Network connection
- âŒ Auth server availability
- âŒ Valid session management
- âŒ Server-side validation

#### Modified (Offline)

```
Login Button Click
    â†“
PartLogin._on_login_button_click() [PATCHED]
    â†“
Get credentials from UI
    â†“
offline_helper.verify_login()
    â†“
Check local JSON file
    â†“
If success: Return player data immediately
If failure: Return error message
    â†“
Set global player data
    â†“
Load game
```

**Dependencies:**
- âœ… offline_accounts.json file only
- âœ… No network required
- âœ… Instant verification
- âœ… Client-side validation

---

## Scene Architecture

### Scene Hierarchy

```
BaseScene (abstract)
    â”‚
    â”œâ”€ LoginScene
    â”‚   â”‚
    â”‚   â”œâ”€ Parts (UI components)
    â”‚   â”‚   â”œâ”€ PartLogin [PATCHED] â˜…
    â”‚   â”‚   â”‚   â”œâ”€ account_input (TextInput)
    â”‚   â”‚   â”‚   â”œâ”€ password_input (TextInput)
    â”‚   â”‚   â”‚   â”œâ”€ login_button (Button)
    â”‚   â”‚   â”‚   â””â”€ offline_helper (OfflineLoginHelper) [ADDED]
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ PartBackground
    â”‚   â”‚   â””â”€ PartLogo
    â”‚   â”‚
    â”‚   â””â”€ Methods
    â”‚       â”œâ”€ __init__()
    â”‚       â”œâ”€ update()
    â”‚       â””â”€ render()
    â”‚
    â”œâ”€ BattleMain (game scene)
    â”‚   â””â”€ [game content]
    â”‚
    â””â”€ OtherScenes...
```

### PartLogin Component Structure

#### Before Patching

```python
class PartLogin:
    def __init__(self, scene):
        self.scene = scene
        self.account_input = TextInput()
        self.password_input = TextInput()
        self.login_button = Button(
            callback=self._on_login_button_click
        )
    
    def _on_login_button_click(self):
        # ORIGINAL: Send to server
        username = self.account_input.text
        password = self.password_input.text
        
        self.scene.network.send_login_request(
            username, password
        )
```

#### After Patching

```python
class PartLogin:
    def __init__(self, scene):
        self.scene = scene
        self.account_input = TextInput()
        self.password_input = TextInput()
        self.login_button = Button(
            callback=self._on_login_button_click
        )
        
        # â˜… ADDED BY PATCH
        self.offline_helper = get_offline_login_helper()
    
    def _on_login_button_click(self):
        # â˜… REPLACED BY PATCH
        username = self.account_input.text
        password = self.password_input.text
        
        success, result = self.offline_helper.verify_login(
            username, password
        )
        
        if success:
            # Set global data and load game
            import game_data
            player_data = result
            game_data.player_id = player_data['player_id']
            # ... set other data ...
            
            from scene.battle.battle_main import BattleMain
            self.scene.change_scene(BattleMain)
```

---

## Class Relationships

### Core Classes Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Manager (Singleton)                     â”‚
â”‚  File: script_patch/422/14606205992556332510.py                 â”‚
â”‚                                                                 â”‚
â”‚  Responsibilities:                                              â”‚
â”‚  â€¢ Resource management                                          â”‚
â”‚  â€¢ File downloading [FIXED]                                     â”‚
â”‚  â€¢ Scene management                                             â”‚
â”‚  â€¢ Game state coordination                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ manages
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Revival (Static)                        â”‚
â”‚  File: 785_17524466876519882393.py                              â”‚
â”‚                                                                 â”‚
â”‚  Responsibilities:                                              â”‚
â”‚  â€¢ Game initialization                                          â”‚
â”‚  â€¢ Configuration patches                                        â”‚
â”‚  â€¢ â˜… OFFLINE LOGIN SYSTEM [INTEGRATED]                         â”‚
â”‚  â€¢   - OfflineLoginHelper class                                 â”‚
â”‚  â€¢   - Singleton accessor function                              â”‚
â”‚  â€¢   - Login patcher function                                   â”‚
â”‚  â€¢   - Auto-patch application                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ initializes
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LoginScene                              â”‚
â”‚  File: script_patch/609/11026820604907119192.py                 â”‚
â”‚                                                                 â”‚
â”‚  Responsibilities:                                              â”‚
â”‚  â€¢ Display login UI                                             â”‚
â”‚  â€¢ Manage Parts components                                      â”‚
â”‚  â€¢ Scene rendering                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ contains
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PartLogin [PATCHED] â˜…                      â”‚
â”‚  File: script_patch/609/11026820604907119192.py                 â”‚
â”‚                                                                 â”‚
â”‚  Original Purpose:                                              â”‚
â”‚  â€¢ Handle login UI                                              â”‚
â”‚  â€¢ Send credentials to server                                   â”‚
â”‚  â€¢ Process server response                                      â”‚
â”‚                                                                 â”‚
â”‚  Modified Behavior:                                             â”‚
â”‚  â€¢ Handle login UI (unchanged)                                  â”‚
â”‚  â€¢ â˜… Verify credentials locally via offline_helper              â”‚
â”‚  â€¢ â˜… Load player data from JSON                                 â”‚
â”‚  â€¢ â˜… Transition to game without network                         â”‚
â”‚                                                                 â”‚
â”‚  New Attribute:                                                 â”‚
â”‚  â€¢ self.offline_helper: OfflineLoginHelper instance             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ uses
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OfflineLoginHelper [NEW] â˜…                   â”‚
â”‚  Defined in: Revival.initialize()                               â”‚
â”‚                                                                 â”‚
â”‚  Responsibilities:                                              â”‚
â”‚  â€¢ Load offline_accounts.json                                   â”‚
â”‚  â€¢ Verify credentials locally                                   â”‚
â”‚  â€¢ Return player data on success                                â”‚
â”‚  â€¢ Handle authentication errors                                 â”‚
â”‚                                                                 â”‚
â”‚  Attributes:                                                    â”‚
â”‚  â€¢ accounts_file: Path to JSON                                  â”‚
â”‚  â€¢ accounts: Dict of username â†’ account_data                    â”‚
â”‚                                                                 â”‚
â”‚  Methods:                                                       â”‚
â”‚  â€¢ load_accounts()                                              â”‚
â”‚  â€¢ verify_login(username, password)                             â”‚
â”‚  â€¢ list_accounts()                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ reads
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   offline_accounts.json [NEW] â˜…                 â”‚
â”‚  File: revival project/offline_accounts.json                    â”‚
â”‚                                                                 â”‚
â”‚  Structure:                                                     â”‚
â”‚  {                                                              â”‚
â”‚    "accounts": [                                                â”‚
â”‚      {                                                          â”‚
â”‚        "account": "username",                                   â”‚
â”‚        "password": "password",                                  â”‚
â”‚        "player_id": "OFFLINE_PLAYER_XXX",                       â”‚
â”‚        "player_name": "Display Name",                           â”‚
â”‚        "level": 50,                                             â”‚
â”‚        "exp": 10000,                                            â”‚
â”‚        "gold": 50000,                                           â”‚
â”‚        "gems": 5000                                             â”‚
â”‚      }                                                          â”‚
â”‚    ]                                                            â”‚
â”‚  }                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Dependency Graph

```
offline_accounts.json
        â†‘
        â”‚ reads
        â”‚
OfflineLoginHelper (defined in Revival)
        â†‘
        â”‚ singleton instance
        â”‚
get_offline_login_helper() (defined in Revival)
        â†‘
        â”‚ called by patch
        â”‚
patch_partlogin_for_offline() (defined in Revival)
        â†‘
        â”‚ patches
        â”‚
PartLogin (in LoginScene)
        â†‘
        â”‚ uses
        â”‚
LoginScene
        â†‘
        â”‚ manages
        â”‚
Manager
        â†‘
        â”‚ initializes
        â”‚
Revival.initialize()
        â†‘
        â”‚ called from
        â”‚
init_game module
        â†‘
        â”‚ called from
        â”‚
start_game()
        â†‘
        â”‚ called from
        â”‚
logic() in bootstrap
        â†‘
        â”‚ called from
        â”‚
Entry point script
```

---

## Data Flow Diagrams

### Account Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ offline_accounts.json        â”‚
â”‚                              â”‚
â”‚ â€¢ Storage: Filesystem        â”‚
â”‚ â€¢ Format: JSON               â”‚
â”‚ â€¢ Encoding: UTF-8            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ File I/O (read)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OfflineLoginHelper           â”‚
â”‚ .load_accounts()             â”‚
â”‚                              â”‚
â”‚ â€¢ Parse JSON                 â”‚
â”‚ â€¢ Build accounts dict        â”‚
â”‚ â€¢ Cache in memory            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ In-memory dict
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ self.accounts                â”‚
â”‚                              â”‚
â”‚ Key: username (string)       â”‚
â”‚ Value: account_data (dict)   â”‚
â”‚                              â”‚
â”‚ {                            â”‚
â”‚   'test': {...},             â”‚
â”‚   'admin': {...},            â”‚
â”‚   'player': {...}            â”‚
â”‚ }                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ Lookup by key
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ verify_login()               â”‚
â”‚                              â”‚
â”‚ â€¢ Get account_data by key    â”‚
â”‚ â€¢ Compare passwords          â”‚
â”‚ â€¢ Build player_data          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ Return player_data
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PartLogin                    â”‚
â”‚ ._on_login_button_click()    â”‚
â”‚                              â”‚
â”‚ â€¢ Receive player_data        â”‚
â”‚ â€¢ Validate success           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ Set globals
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ game_data module             â”‚
â”‚                              â”‚
â”‚ â€¢ player_id = ...            â”‚
â”‚ â€¢ player_name = ...          â”‚
â”‚ â€¢ player_level = ...         â”‚
â”‚ â€¢ player_exp = ...           â”‚
â”‚ â€¢ player_gold = ...          â”‚
â”‚ â€¢ player_gems = ...          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ Used by game
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BattleMain scene             â”‚
â”‚                              â”‚
â”‚ â€¢ Access game_data.player_*  â”‚
â”‚ â€¢ Display player info        â”‚
â”‚ â€¢ Game logic                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Patching Process Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GAME STARTS                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Revival.initialize() CALLED                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEFINE OfflineLoginHelper CLASS                              â”‚
â”‚ (Class definition added to local scope)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEFINE get_offline_login_helper() FUNCTION                   â”‚
â”‚ (Function added to local scope)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEFINE patch_partlogin_for_offline() FUNCTION                â”‚
â”‚ (Function added to local scope)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EXECUTE patch_partlogin_for_offline()                        â”‚
â”‚ (Patching begins)                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IMPORT PartLogin CLASS                                       â”‚
â”‚ from scene.battle.parts.part_login import PartLogin          â”‚
â”‚                                                              â”‚
â”‚ PartLogin = <class object at memory address>                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STORE ORIGINAL METHODS (backup)                              â”‚
â”‚                                                              â”‚
â”‚ original_init = PartLogin.__init__                           â”‚
â”‚ original_on_login_click = PartLogin._on_login_button_click   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEFINE NEW __init__ METHOD                                   â”‚
â”‚                                                              â”‚
â”‚ def new_init(self, *args, **kwargs):                         â”‚
â”‚     original_init(self, *args, **kwargs)  # Call original    â”‚
â”‚     self.offline_helper = get_offline_login_helper()         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEFINE NEW _on_login_button_click METHOD                     â”‚
â”‚                                                              â”‚
â”‚ def new_on_login_click(self, *args, **kwargs):              â”‚
â”‚     username = self.account_input.text                       â”‚
â”‚     password = self.password_input.text                      â”‚
â”‚     success, result = self.offline_helper.verify_login(...)  â”‚
â”‚     if success: [load game]                                  â”‚
â”‚     else: [show error]                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REPLACE CLASS METHODS (PATCHING) â˜…                           â”‚
â”‚                                                              â”‚
â”‚ PartLogin.__init__ = new_init                                â”‚
â”‚ PartLogin._on_login_button_click = new_on_login_click        â”‚
â”‚                                                              â”‚
â”‚ [Class is now permanently modified in memory]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PATCHING COMPLETE                                            â”‚
â”‚ Console: [OfflineLogin] PartLogin successfully patched!      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GAME CONTINUES LOADING                                       â”‚
â”‚ â€¢ LoginScene loads                                           â”‚
â”‚ â€¢ PartLogin instantiated (NEW __init__ runs)                 â”‚
â”‚ â€¢ offline_helper attached                                    â”‚
â”‚ â€¢ Login button click handler = NEW method                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER SEES LOGIN UI                                           â”‚
â”‚ â€¢ Original appearance                                        â”‚
â”‚ â€¢ Backend = offline authentication                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## System Integration Points

### Critical Integration Points

#### 1. Entry Point Integration

**File:** `script_patch/573/10076230044261121434.py`  
**Function:** `logic()`  
**Integration Type:** Direct modification

```python
# Point of integration
def logic():
    # Original: Server checks here
    # Modified: Direct game start
    start_game()
```

**Impact:** All server checks bypassed

---

#### 2. Revival Initialization Integration

**File:** `785_17524466876519882393.py`  
**Method:** `Revival.initialize()`  
**Integration Type:** Code injection

```python
@staticmethod
def initialize():
    # ... existing code ...
    
    # INTEGRATION POINT: Offline system embedded here
    class OfflineLoginHelper: pass
    def get_offline_login_helper(): pass
    def patch_partlogin_for_offline(): pass
    patch_partlogin_for_offline()  # Apply immediately
    
    # ... rest of initialization ...
```

**Impact:** Patches applied before LoginScene loads

---

#### 3. PartLogin Class Integration

**File:** `script_patch/609/11026820604907119192.py`  
**Class:** `PartLogin`  
**Integration Type:** Runtime monkey-patching

```python
# Original class (not modified directly)
class PartLogin:
    def __init__(self, scene): ...
    def _on_login_button_click(self): ...

# Integration happens at runtime:
# Revival.initialize() â†’ patch_partlogin_for_offline()
# â†’ PartLogin.__init__ = new_init
# â†’ PartLogin._on_login_button_click = new_on_login_click
```

**Impact:** Login behavior changed without editing class file

---

#### 4. Global Game Data Integration

**Module:** `game_data` (assumed)  
**Integration Type:** Global variable assignment

```python
# Integration in patched _on_login_button_click:
import game_data
game_data.player_id = player_data['player_id']
game_data.player_name = player_data['player_name']
# ... etc
```

**Impact:** Player data available throughout game

---

#### 5. Scene Transition Integration

**Integration:** BattleMain scene loading

```python
# In patched _on_login_button_click:
from scene.battle.battle_main import BattleMain
self.scene.change_scene(BattleMain)
```

**Impact:** Smooth transition to game after login

---

### Integration Validation Checklist

âœ… **Entry Point**
- Server checks removed
- Direct game start implemented

âœ… **Revival Init**
- Offline system defined
- Patches applied at runtime
- No errors during initialization

âœ… **PartLogin**
- __init__ extended with offline_helper
- _on_login_button_click replaced
- Original UI preserved

âœ… **Global Data**
- game_data module accessible
- Player variables set correctly

âœ… **Scene Transition**
- BattleMain import successful
- change_scene() called correctly

---

## Troubleshooting Guide

### Common Issues & Solutions

#### Issue 1: "Account not found" error

**Symptom:** Valid username shows "Account not found"

**Cause:** offline_accounts.json not loaded properly

**Solution:**
1. Check console for: `[OfflineLogin] Loaded X accounts from: <path>`
2. Verify JSON file exists
3. Check JSON syntax (commaseparation, brackets)
4. Try absolute path in OfflineLoginHelper.__init__()

---

#### Issue 2: Game crashes on login

**Symptom:** Game exits when clicking Login button

**Cause:** Patching failed or incomplete

**Solution:**
1. Check console for: `[OfflineLogin] PartLogin successfully patched!`
2. Verify Revival.initialize() completed
3. Check for Python syntax errors in patch code
4. Add more try-except blocks for debugging

---

#### Issue 3: Original server login attempted

**Symptom:** Network errors, connection timeouts

**Cause:** Patches not applied before PartLogin instantiation

**Solution:**
1. Ensure Revival.initialize() called before LoginScene loads
2. Check patch_partlogin_for_offline() executed
3. Verify import of PartLogin successful
4. Add print statements to confirm patching order

---

#### Issue 4: Login UI doesn't appear

**Symptom:** Blank screen or immediate crash

**Cause:** LoginScene loading issue (unrelated to offline mod)

**Solution:**
1. Check LoginScene.__init__() for errors
2. Verify UI resources loaded
3. Check graphics initialization
4. Not caused by offline modifications

---

## Summary

### Architecture Highlights

ğŸ—ï¸ **Modular Design**
- Clear separation of concerns
- Single responsibility per component
- Easy to maintain and extend

ğŸ”§ **Runtime Patching**
- Non-invasive modifications
- Original code preserved
- Flexible and reversible

ğŸ“Š **Data-Driven**
- JSON-based account storage
- Easy to add/modify accounts
- No code changes needed for new users

ğŸ”„ **Seamless Integration**
- Fits into existing game flow
- Minimal performance impact
- Original UI/UX maintained

---

*Last Updated: January 31, 2026*  
*See [CHANGELOG.md](CHANGELOG.md) and [MODIFICATIONS.md](MODIFICATIONS.md) for details*
